{
  "variables": {
    "ova_checksum": "1f1f480c10305c8bb72516fa7060303311e18a29009a57689780a45a7e22880a",
    "ova_checksum_type": "sha256",
    "ova_url": "https://images.offensive-security.com/virtual-images/kali-linux-2020.1-vbox-amd64.ova",

    "box_name": "kali-2020.1",
    "box_desc": "Kali Linux 2020.1 64-Bit",
    "box_family": "kali-linux",

    "home": "{{env `HOME`}}",

    "google_bucket_images": "---See README---"
  },
  "description": "{{user `box_desc`}}",

  "builders": [
    {
      "type": "virtualbox-ovf",
      "source_path": "{{user `ova_url`}}",
      "guest_additions_mode": "disable",

      "checksum": "{{user `ova_checksum`}}",
      "checksum_type": "{{user `ova_checksum_type`}}",

      "ssh_wait_timeout": "30s",
      "ssh_username": "kali",
      "ssh_password": "kali",

      "import_flags": [
          "--vsys", "0",
          "--eula", "accept"
      ],

      "shutdown_command": "echo 'kali' | sudo -S shutdown -P now",
      "boot_wait": "2s",
      "boot_command": [
          "<esc><wait>e<wait><down><down><down><down><wait>",
          "<down><down><down><down><down><down><down><down><down><down><wait>",
          "<leftCtrlOn>e<leftCtrlOff> systemd.unit=multi-user.target<wait>",
          "<leftCtrlOn>x<leftCtrlOff><wait10>",
          "kali<enter><wait>kali<enter><wait2>",
          "echo 'kali' | sudo -S systemctl start ssh<wait><enter>"
      ]
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "inline": ["echo 'kali' | sudo -S apt-get update && echo 'kali' | sudo -S apt-get -y upgrade"]
    }
  ],

  "post-processors": [
    {
        "type": "compress",
        "output": "packer_output/{{user `box_name`}}.tar.gz"
    }
  ]
}
